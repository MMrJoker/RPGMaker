[トップページに戻る](README.md)

# [FTKR_AlternatingTurnBattle](FTKR_AlternatingTurnBattle.js) プラグイン

敵味方交互にターンが進むターン制戦闘システムのプラグインです。

ダウンロード: [FTKR_AlternatingTurnBattle.js](https://raw.githubusercontent.com/futokoro/RPGMaker/master/FTKR_AlternatingTurnBattle.js)

## 目次

以下の項目の順でプラグインの使い方を説明します。
1. [概要](#概要)
1. [ターンの進行](#ターンの進行)
1. [プレイヤーのターン](#プレイヤーのターン)
1. [エネミーのターン](#エネミーのターン)
1. [行動回数](#行動回数)
1. [アクションポイント](#アクションポイント)
1. [スクリプト](#スクリプト)
1. [プラグインコマンド](#プラグインコマンド)
* [プラグインの更新履歴](#プラグインの更新履歴)
* [ライセンス](#ライセンス)

## 概要

このプラグインを導入すると、敵味方交互にターンが進むターン制戦闘システムに変更します。

この戦闘システムは、基本的にプレイヤー側が有利に戦闘を進めることができます。

[目次に戻る](#目次)

## ターンの進行

ターンの進行は、以下の様になります。
```
 １ターン目開始⇒プレイヤーの１ターン目⇒エネミーの１ターン目⇒１ターン目終了
２ターン目開始⇒プレイヤーの２ターン目⇒･･･
```
先制攻撃が発生すると、エネミーの１ターン目が無くなり、
連続でプレイヤーが行動できます。

不意打ちが発生すると、プレイヤーの１ターン目が無くなり
エネミーの１ターン目から始まります。

[目次に戻る](#目次)

## プレイヤーのターン

プレイヤーのターンでは、以下の仕様になります。

1. アクターの行動順は任意に選択できます。
2. pgUpキーとpgDnキーで行動させるアクターを選択できます。(*1)
3. アクターを選択し行動を決定すると、即座にスキルが発動し、その後に次に行動するアクター選択に移ります。
4. キャラが行動すると、そのキャラの行動回数を１消費し、さらに、使用したスキルのアクションポイントの分、パーティーのアクションポイントを消費します。
5. 全員が行動済みになるか、パーティーのアクションポイントが 0 になるかパーティーコマンドの「ターン終了」を選ぶと、エネミーのターンに移ります。
6. キャンセルキーで、パーティーコマンドを表示できます。
7. 誰かが行動したターンでは、パーティーコマンドの「逃げる」は実行できなくなります。

(*1)プラグインパラメータ Change Player で操作方法は変更できます。

[目次に戻る](#目次)

## エネミーのターン

エネミーのターンでは、従来のMVのシステムとほぼ同じです。

1. エネミーの行動順は、エネミーの敏捷性と使用するスキルの速度補正によって決まります。
2. エネミーは、各ターン開始時に使用するスキルと行動順を決めます。

[目次に戻る](#目次)

## 行動回数

アクターは設定された行動回数の分だけ、毎ターン行動できます。

アクターの行動回数は、特徴の行動回数追加の合計＋１回です。
この値が毎ターンの行動回数になります。

ただし、ターン中にプラグインコマンドを実行することでそのターンだけ行動回数を増減させることができます。

プラグインコマンドで変化させた行動回数は、次のターンには元に戻ります。

なお、プラグインパラメータ`Disable AC`を"無効にする"に設定するとアクターは行動しても行動回数が減らなくなります。
この状態では、アクションポイントがある限り、何度でも同じアクターで行動することが可能です。

スキルやアイテムのメモ欄に、`<AltTB_noAC>`と記入するとそのスキルやアイテムを使用しても行動回数を消費ません。

[目次に戻る](#目次)

## アクションポイント

アクションポイントは、プラグインパラメータ`Enable AP`を有効にすると使用できます。

パーティーはアクションポイントというパラメータを持っています。
各アクターは行動時に、行動回数とは別に、このアクションポイントを消費します。
アクションポイントの現在値を超える行動はすることができません。

消費したアクションポイントは、ターン開始時に一定量回復します。

アクションポイントの消費量は、使用したスキルごとに個別に変わります。

### パーティーのアクションポイントの設定
パーティーのアクションポイント最大値は、プラグインパラメータ`Party AP`で設定できます。
また、プラグインコマンドで、現在値や最大値を変更できます。

### スキルやアイテムのアクションポイントの設定
スキルやアイテム使用時に消費するアクションポイントは、以下の方法で設定します。
1. プラグインパラメータ`Item AP`で、全スキル・アイテム共通のデフォルト値を設定。
2. 個別に、メモ欄に`<AltTB_AP: n>`で設定。n が消費量です。
なお、個別の設定を優先します。

また、スキルのメモ欄に`<AltTB_GainAP: n>`と設定すると、そのスキルを使用した時に、命中時に n ポイントAPを取得できます。

### ターン毎のアクションポイント回復量
プラグインパラメータ`Turn Refresh AP`で、ターン毎の回復量を設定できます。
回復量はスクリプトで設定できます。

### 戦闘毎のアクションポイントのリセット
アクションポイントは戦闘毎にリセットされ、0 から開始します。
ただし、プラグインパラメータ`Enable Reset AP Every Battle`を無効にすることでアクションポイントを持ち越すことができます。

[目次に戻る](#目次)

## スクリプト

このプラグインでは、以下のスクリプトが使用できます。

### 行動回数の現在値の取得
アクターID n の場合

`$gameActors.actor(n).actionCount()`

パーティーの n 番目のキャラの場合

`$gameParty.members()[n-1].actionCount()`

敵グループの n 番目のキャラの場合

`$gameTroop.members()[n-1].actionCount()`

### パーティーのアクションポイントの現在値の取得
`$gameParty.actionPoint()`

### パーティーのアクションポイントの最大値の取得
`$gameParty.maxActionPoint()`

[目次に戻る](#目次)

## プラグインコマンド

このプラグインでは、以下のプラグインコマンドが使用できます。
※[]は実際の入力に使用しません

### 行動回数の増加
対象の行動回数を操作します。減らすことも出来ます。
減らしたことで、行動回数が 0 になった対象は、そのターン行動できなくなります。
```
AltTB_行動回数増加 [対象分類] [対象ID] [増加量]
AltTB_ADD_AC [targetType] [targetId] [value]
```
#### 対象分類(targetType)
行動回数を増加させる対象をどのように選ぶかを指定します。
以下の文字列を入力してください。
* アクターまたは Actor
* パーティー または Party
* 敵グループ または Troop

#### 対象ID(targetId)
対象分類に合わせて、以下のIDを指定します。
* アクターなら、対象のアクターID。
* パーティーなら、パーティー先頭を 1 とした並び順。
* 敵グループなら、敵グループ先頭を 1 とした並び順。

\v[n] と指定することで変数 n の値を参照できます。

#### 増加量(value)
行動回数を増加させる値を指定します。
負の値を指定した場合、対象の行動回数は減少します。
\v[n] と指定することで変数 n の値を参照できます。

#### 入力例)
```
AltTB_行動回数増加 アクター 1 1
AltTB_ADD_AC Actor 1 1
```
アクターID 1 の行動回数を 1 増やします。

```
AltTB_行動回数増加 パーティー 2 \v[5]
AltTB_ADD_AC Party 2 \v[5]
```
パーティーの 2 番目のキャラの行動回数を 変数ID 5 の値分、増やします。

```
AltTB_行動回数増加 敵グループ 3 -1
AltTB_ADD_AC Troop 3 -1
```
敵グループの 3 番目のキャラの行動回数を 1 減らします。

### アクションポイントの増加
パーティーのアクションポイントの現在値を操作します。減らすこともできます。
減らしたことで、アクションポイントが 0 になった場合は、プレイヤーターンを終了します。
```
AltTB_アクションポイント増加 [増加量]
AltTB_ADD_AP [value]
```
#### 増加量(value)
アクションポイントを増加させる値を指定します。
負の値を指定した場合、アクションポイントは減少します。
\v[n] と指定することで変数 n の値を参照できます。

#### 入力例)
```
AltTB_アクションポイント増加 1
AltTB_ADD_AP 1
```
アクションポイントを 1 増やします。

[目次に戻る](#目次)

## 拡張

[FTKR_BattleWindowLayout](FTKR_BattleWindowLayout.ja.md)と組み合わせた場合の画面はこのようになります。

#### AP表示あり
![画像](image/FTKR_AlternatingTurnBattle/n01_002.png)

![画像](image/FTKR_AlternatingTurnBattle/n01_003.png)

[目次に戻る](#目次)

## プラグインの更新履歴

| バージョン | 公開日 | 更新内容 |
| --- | --- | --- |
| [ver1.2.2](FTKR_AlternatingTurnBattle.js)| 2018/04/30 | 自動でプレイヤーターンを飛ばす処理が正常に動作しない不具合を修正<br>エネミーターンに移行した直後にゲームが止まる不具合を修正<br>特定のスキル・アイテムの行動回数の消費を無効にする機能を追加 |
| ver1.2.1| 2018/04/29 | AP0になった時に、ゲームがフリーズする不具合を修正<br>戦闘行動の強制で消費APを無効にしても、AP0になった際に戦闘行動の強制を実行できない不具合を修正<br>アクターの行動回数を無効にした時に、同じアクターを２回以上行動させるとエラーになる不具合を修正<br>アクターの行動回数を無効にした時に、エネミーターンが終わらない不具合を修正<br>プレイヤーが全員行動できなくなった時に、自動でプレイヤーターンを飛ばすかどうか設定する機能を追加<br>パーティーの初期APとスキル・アイテムの消費APのデフォルト値を、どちらも 0 に設定できるように変更 |
| ver1.2.0| 2018/04/29 | アクションポイントウィンドウのレイアウト設定機能を追加<br>スキル使用後にAPを一定値自動取得可能な機能を追加<br>アクターの行動回数による行動制限を無効にする機能を追加 |
| ver1.1.0| 2018/04/09 | アクターコマンドのAP表示部の処理を見直し<br>APの表示幅や表示色を設定する機能を追加<br>残り行動回数を表示する機能を追加<br>マウスクリックでアクターを変更する機能を追加 |
| ver1.0.0 | 2018/04/08 | 初版作成 |

## 拡張プラグイン

以下のプラグインを使用することで、本プラグインの機能を拡張できます。

* [FTKR_BattleWindowLayout](FTKR_BattleWindowLayout.ja.md) - 戦闘時のウィンドウ配置を変更する。

## ライセンス

本プラグインはMITライセンスのもとで公開しています。

[The MIT License (MIT)](https://opensource.org/licenses/mit-license.php)

#
[目次に戻る](#目次)

[トップページに戻る](README.md)