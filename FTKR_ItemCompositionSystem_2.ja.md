[トップページに戻る](README.md)
[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

# アイテムの合成の設定

## アイテムのタグ設定

アイテムに設定可能なタグは以下があります。

* [合成カテゴリー](#合成カテゴリーのタグ設定)
* [合成ランク](#合成ランクのタグ設定)
* [合成アイテム](#合成アイテムのタグ設定)
* [合成レシピ](#合成レシピのタグ設定)

### 合成カテゴリーのタグ設定

下記のいずれかを入力することで、合成カテゴリーを指定します。
設定しない場合は、アイテム分類と同じになります。
```
<ICS アイテム>
<ICS 武器>
<ICS 防具>
<ICS カテゴリー: カテゴリー名>
```

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

### 合成ランクのタグ設定
以下のタグで、アイテムにランクを設定できます。
```
<ICS ランク: x>
```
合成後にできるアイテムのランクは、素材に使用したアイテムのランクの平均値です。
ランク 0 のアイテムは、ランク計算には使いません。
このタグを設定しない場合は、ランク 0 と見なします。

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

### 合成アイテムのタグ設定
以下のノートタグで、アイテムを合成アイテムに設定できます。
```
<ICS 合成アイテム>
```
合成アイテムに指定すると、合成ランクの計算上で無いものとして扱われます。

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

### 合成レシピのタグ設定
レシピは、以下の記述で入力します。
レシピの内容については、レシピの設定を参照してください。
レシピは、一つのアイテムやカテゴリーに対して複数設定することができます。

```
<ICS レシピ>
内容
</ICS レシピ>
```

内容部分で設定できる項目は以下の通りです。

* [生成数の設定](#生成数の設定)
* [素材の設定](#素材の設定)
* [合成難易度の設定](#合成難易度の設定)
* [成功以外の合成結果の設定](#成功以外の合成結果の設定)
* [合成の必要条件の設定](#合成の必要条件の設定)
* [成功ボーナスの設定](#成功ボーナスの設定)

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

#### 生成数の設定
合成でできあがるアイテムの数を y に設定します。
```
生成数: y
```

#### 素材の設定
合成に必要な素材アイテムを設定します。
以下のいずれかの記述で入力してください。
```
アイテム[x]: y
武器[x]: y
防具[x]: y
アイテム名: y
カテゴリー[カテゴリー名]: y
```
* x - アイテムや武器等のID
* y - 必要な個数

#### 合成難易度の設定
合成の難易度を数値で設定します。
大成功の難易度が x、成功が y、失敗が z です。
```
難易度: x, y, z
```

#### 成功以外の合成結果の設定
大成功および失敗時の合成アイテムの内容を設定します。
入力しない場合は、発生しません。
例えば、大成功を入力しなければ、大成功しません。
```
大成功: 内容
失敗: 内容
```
以下の内容から選んで入力してください。

* `生成数変更(x)`
    * 生成数を変更します。負の値の場合は減ります。

* `ランク変更(x)`
    * 生成後のアイテムのランクを変更します。負の値の場合は減ります。
    * ランクが減ったことで 0 になる、またはそのランク以下のアイテムが
    ない場合は、何も生成しません。

* `カテゴリー変更(カテゴリー名)`
    * 生成後のアイテムのカテゴリーを変更します。
      変更後のカテゴリーの同ランクのアイテムになります。

* `アイテム変更(アイテム名)`
    * ランクやカテゴリーを無視して、指定したアイテムに変更します。

* `なし`
    * 何も生成しません。生成数を 0 に変更します。

入力例)
```
大成功: 生成数変更(3)
失敗: 生成数変更(1)
大成功の時に生成数が3に、失敗の時に生成数が1になる。
```

#### 合成の必要条件の設定
成功および大成功するために必要な条件を設定します。
この条件に満たない場合は、必ず失敗、または消失になります。
```
必要条件: 条件式
```

#### 成功ボーナスの設定
成功および大成功した時にアイテム入手以外にボーナスを設定できます。
```
大成功ボーナス: 内容
成功ボーナス: 内容
```
大成功ボーナスを設定しない場合、大成功時のボーナスは成功ボーナスになります。
内容はスクリプトで入力できます。


#### 条件式 の値について
条件式は、ダメージ計算式のように、計算式を入力することで、固定値以外の値を
使用することができます。以下のコードを使用できます。
* a[x].param - アクターID x のパラメータを参照します。
* s[x]    - スイッチID x の状態を参照します。
* v[x]    - 変数ID x の値を参照します。

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

## カテゴリー合成の設定

カテゴリー合成レシピは、データベースの武器に作成します。

![スキルツリーの設定1](image/FTKR_ItemCompositSystem/n02_004.png)

### 合成カテゴリーの設定

カテゴリー合成のレシピを作成するために、まず「武器タイプ」にカテゴリー合成レシピ用のタイプを作成してください。
武器タイプ名を「合成カテゴリー」などと付けると、分かりやすくなると思います。

設定した武器タイプIDは、プラグインパラメータ`Category Type ID`に設定してください。

![スキルツリーIDの登録](image/FTKR_ItemCompositSystem/n02_001.png)

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

### カテゴリー合成レシピの設定

カテゴリー合成として設定が必要なデータは以下の通りです。

1. 武器タイプには、先ほど登録した合成カテゴリーIDを選択してください。
2. 武器の名前が合成カテゴリーの名前になります。
3. 武器のアイコンがアイテム合成画面でレシピを表示したときのアイコンになります。
4. メモ欄に合成用のタグを追加してください。

カテゴリー合成のレシピは、以下のように合成素材に合成カテゴリーを指定します。

```
<ICS_レシピ>
カテゴリー[カテゴリー名]: 必要素材数
アイテム名: 必要素材数
</ICS_レシピ>
```
合成素材には、合成カテゴリー以外も指定しても問題ないですが、基本的に１種類以上は合成カテゴリーを指定してください。

![スキルツリーの設定2](image/FTKR_ItemCompositSystem/n02_005.png)

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

### 合成素材の合成カテゴリー素材の設定

カテゴリー合成レシピに指定した合成カテゴリーに該当する合成素材を設定します。

合成カテゴリー用の素材には、以下のように合成カテゴリーと合成ランクのタグを設定してください。

![素材](image/FTKR_ItemCompositSystem/n02_002.png)

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

## 特殊合成の設定

カテゴリー合成レシピに`<ICS 特殊合成>`タグを追記すると、この特殊合成になります。
通常の合成とは異なり、合成仕様が変わります。

素材に使用できるアイテム分類は「武器」および「防具」だけです。

![画像](image/FTKR_ItemCompositSystem/n04_001.png)

### 特殊合成の仕様

1. レシピの一つ目に設定した素材をベースアイテムとします。
2. レシピの二つ目以降に設定した素材を付加アイテムとします。
   なお、「合成アイテム」タグをつけたアイテムは除きます。
3. 合成してできるアイテムは、ベースアイテムに付加アイテムの性能を一部乗せたアイテムになります。
4. 特殊合成は、レシピから選ぶことはできません。
5. 特殊合成は、ランク変更、カテゴリー変更、アイテム変更は選べません。

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

### 合成してできるアイテムの仕様

1. アイテム分類および基本設定は、ベースアイテムと同じです。
2. 合成により、付加アイテムの能力値、または特徴をベースアイテムに付与します。
3. 付与する能力の数は、生成数に従います。
   生成数が 0 以下の場合は、何も付与しません。
4. ベースアイテムと同じ見た目ですが、ベースアイテムとは別物です。
   アイテムIDが異なりますので、武器・防具の所持数を取得する場合に別アイテムとして数えます。
5. オリジナルアイテムの名前は、「ベースアイテム名(+合成回数)」になります。

作成例）
ベースアイテムがショートソードで、合成回数が1回の場合に出来上がるアイテムは、「ショートソード(+1)」です。

![画像](image/FTKR_ItemCompositSystem/n04_002.png)

[上に戻る](#アイテムの合成の設定)　　　[目次に戻る](FTKR_ItemCompositionSystem.ja.md#目次)

#
[トップページに戻る](README.md)